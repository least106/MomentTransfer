# 用户手册

完整的 MomentConversion 使用指南，涵盖三个入口的详细说明。

## 目录

1. [CLI - 命令行工具](#cli---命令行工具)
2. [批处理 - 文件处理](#批处理---文件处理)
3. [GUI - 图形界面](#gui---图形界面)
4. [坐标系概念](#坐标系概念)
5. [输出文件格式](#输出文件格式)

---

## CLI - 命令行工具

### 概述

CLI 工具用于**单点计算**，即计算一组力和力矩的坐标系变换结果。适用于快速验证、脚本集成和自动化流程。

### 命令格式

```bash
python cli.py run [OPTIONS]
```

### 必需参数

| 参数 | 说明 | 示例 |
|------|------|------|
| `-c, --config` | 配置文件路径（JSON） | `-c data/input.json` |
| `--force` | 三个力分量 (X Y Z) | `--force 100 0 -50` |
| `--moment` | 三个力矩分量 (X Y Z) | `--moment 0 500 0` |

### 可选参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `-o, --output` | 输出文件路径（JSON） | 标准输出 |
| `--source-part` | 源坐标系 Part 名称 | 配置中第一个 |
| `--target-part` | 目标坐标系 Part 名称 | 配置中第一个 |
| `--verbose` | 增加日志详细程度 | 关闭 |

### 使用示例

**示例 1：基本计算**

```bash
python cli.py run -c config.json \
  --force 100 0 -50 \
  --moment 0 500 0
```

输出：
```json
{
  "source_force": [100, 0, -50],
  "source_moment": [0, 500, 0],
  "target_force": [86.6, 50, -50],
  "target_moment": [433, 250, 0],
  "force_coeff": [0.825, 0.476, -0.476],
  "moment_coeff": [4.124, 2.381, 0]
}
```

**示例 2：保存输出**

```bash
python cli.py run -c config.json \
  --force 100 0 -50 \
  --moment 0 500 0 \
  -o result.json
```

**示例 3：指定坐标系**

```bash
python cli.py run -c config.json \
  --force 100 0 -50 \
  --moment 0 500 0 \
  --source-part BODY \
  --target-part WIND
```

---

## 批处理 - 文件处理

### 概述

批处理工具用于**大批量文件处理**，适用于处理 CSV、Excel 等数据文件。支持并行化处理和特殊格式自动检测。

### 命令格式

```bash
python batch.py [OPTIONS]
```

### 必需参数

| 参数 | 说明 | 示例 |
|------|------|------|
| `-c, --config` | 配置文件路径（JSON） | `-c data/input.json` |
| `-i, --input` | 输入文件路径 | `-i data/loads.csv` |
| `-o, --output` | 输出文件路径 | `-o data/result.csv` |

### 可选参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `--force-column` | 力列前缀 | "力" |
| `--moment-column` | 力矩列前缀 | "力矩" |
| `--skip-rows` | 跳过的行数 | 0 |
| `--chunk-size` | 批处理块大小 | 10000 |
| `--source-part` | 源 Part 名称 | 配置中第一个 |
| `--target-part` | 目标 Part 名称 | 配置中第一个 |

### 输入文件格式

#### CSV 格式

```csv
时间,力X,力Y,力Z,力矩X,力矩Y,力矩Z
0,100,0,-50,0,500,0
1,110,5,-45,10,510,5
2,105,-3,-55,-5,490,-10
```

#### 列名约定

- 力列：`力X`, `力Y`, `力Z` 或 `Force_X`, `Force_Y`, `Force_Z`
- 力矩列：`力矩X`, `力矩Y`, `力矩Z` 或 `Moment_X`, `Moment_Y`, `Moment_Z`

### 使用示例

**示例 1：基本批处理**

```bash
python batch.py -c config.json \
  -i data/loads.csv \
  -o data/result.csv
```

**示例 2：自定义列名**

```bash
python batch.py -c config.json \
  -i data/loads.csv \
  -o data/result.csv \
  --force-column "Fx" \
  --moment-column "Mx"
```

**示例 3：处理大文件**

```bash
python batch.py -c config.json \
  -i data/large_file.csv \
  -o data/result.csv \
  --chunk-size 50000
```

### 输出文件格式

结果文件包含原始数据和变换结果：

```csv
时间,力X,力Y,力Z,力矩X,力矩Y,力矩Z,变换力X,变换力Y,变换力Z,变换力矩X,变换力矩Y,变换力矩Z,气动力系数X,...
0,100,0,-50,0,500,0,86.6,50,-50,433,250,0,0.825,0.476,...
1,110,5,-45,10,510,5,98.2,55,-40,450,263,5,0.936,0.524,...
```

---

## GUI - 图形界面

### 概述

GUI 提供**交互式操作界面**，集成配置管理、文件批处理、结果预览等功能。

### 启动

```bash
python gui_main.py
```

### 主界面布局

```
┌─ 菜单栏 ──────────────────────────────────┐
├─ 工具栏 (加载配置、保存等) ────────────────┤
├─┬─ 左侧边栏                   ┌─ 主工作区 ─┐
│ │ • 配置管理面板             │ • 配置编辑  │
│ │ • Part 映射面板            │ • 操作面板  │
│ │ • 批处理面板               │ • 结果预览  │
│ │ • 处理历史                 │             │
└─┴────────────────────────────┴─────────────┘
└─ 状态栏 ─────────────────────────────────┘
```

### 主要功能

#### 1. 配置管理

1. **加载配置**
   - 点击"加载配置"按钮
   - 选择 JSON 配置文件
   - 系统自动解析坐标系和参考参数

2. **配置预览**
   - 配置加载后自动显示在"配置编辑"面板
   - 可查看源/目标坐标系定义
   - 显示参考面积、速度等参数

#### 2. Part 映射

1. **选择 Source Part**
   - 从"Source Part"下拉列表选择源坐标系
   - 支持多 Part 配置（如 BODY、WING 等）

2. **选择 Target Part**
   - 从"Target Part"下拉列表选择目标坐标系

#### 3. 批处理

1. **添加输入文件**
   - 点击"添加文件"按钮
   - 选择单个或多个 CSV 文件
   - 系统显示文件列表和预览

2. **配置处理参数**
   - 设置"力列前缀"和"力矩列前缀"
   - 指定输出目录
   - 选择是否覆盖已有结果

3. **执行批处理**
   - 点击"开始处理"按钮
   - 实时显示处理进度
   - 自动生成输出文件

4. **查看结果**
   - 批处理完成后自动显示结果预览
   - 可查看行数、列名、样本数据等
   - 支持导出和重新处理

#### 4. 处理历史

- 自动记录所有处理操作
- 显示时间戳、文件名、状态等
- 支持重新执行历史任务

### 常见操作

**操作 1：批量处理多个文件**

1. 加载配置
2. 设置 Source/Target Part
3. 点击"添加文件"选择多个 CSV 文件
4. 点击"开始处理"
5. 等待完成并查看结果

**操作 2：处理特殊格式数据**

- GUI 会自动检测特殊数据格式（如某些风洞数据格式）
- 自动转换为标准格式处理
- 无需手动干预

**操作 3：保存项目**

- 点击"保存项目"保存当前配置和处理历史
- 下次启动时可快速恢复

---

## 坐标系概念

### 坐标系定义

每个坐标系由以下参数定义：

```json
{
  "Orig": [0, 0, 0],           // 原点坐标
  "X": [1, 0, 0],              // X 轴方向向量
  "Y": [0, 1, 0],              // Y 轴方向向量
  "Z": [0, 0, 1]               // Z 轴方向向量
}
```

### 常见坐标系

| 坐标系 | 说明 | 应用场景 |
|--------|------|--------|
| BODY | 机体坐标系 | 飞行器结构坐标系 |
| WIND | 风坐标系 | 气动力分析 |
| STABILITY | 稳定坐标系 | 飞行控制 |

### 变换原理

```
输入力/力矩 (BODY坐标系)
       ↓
    旋转变换矩阵
       ↓
输出力/力矩 (WIND坐标系)
       ↓
    无量纲化 (除以参考值)
       ↓
气动系数
```

---

## 输出文件格式

### CSV 输出

结果 CSV 文件包含：

| 列 | 说明 |
|----|------|
| 原始数据列 | 源数据（力、力矩、时间等） |
| 变换力X/Y/Z | 变换后的力分量 |
| 变换力矩X/Y/Z | 变换后的力矩分量 |
| 气动力系数X/Y/Z | 无量纲化后的力系数 |
| 气动力矩系数X/Y/Z | 无量纲化后的力矩系数 |

### JSON 输出 (CLI)

```json
{
  "source_force": [100, 0, -50],
  "source_moment": [0, 500, 0],
  "target_force": [86.6, 50, -50],
  "target_moment": [433, 250, 0],
  "force_coeff": [0.825, 0.476, -0.476],
  "moment_coeff": [4.124, 2.381, 0],
  "metadata": {
    "source_part": "BODY",
    "target_part": "WIND",
    "reference_area": 10.5,
    "timestamp": "2026-02-03T10:30:00"
  }
}
```

### 无量纲化公式

```
力系数 = 变换力 / (动压 × 参考面积)
力矩系数 = 变换力矩 / (动压 × 参考面积 × 参考长度)
```

其中：
- 动压 (Q) = 0.5 × 空气密度 × 速度²
- 参考面积 (S) = 飞行器翼面积
- 参考长度 (L) = 飞行器特征长度

# 文件验证状态符号说明

## 概述

在 MomentTransfer GUI 的批处理管理器中，文件树会显示文件的验证状态符号。这些符号帮助用户快速了解每个文件是否已就绪进行处理。

## 状态符号表

| 符号 | 名称 | 含义 | 处理状态 |
|------|------|------|--------|
| ✓ | 对号 | 文件配置正常且已就绪 | 可以进行处理 |
| ⚠ | 警告 | 文件配置不完整或存在问题 | 需要补充配置 |
| ❓ | 问号 | 文件状态无法验证 | 需要检查日志 |

## 详细说明

### ✓ 对号（Ready/Success）

**含义**：文件配置正常且已就绪。

**具体适用场景**：
- **特殊格式文件**：所有 parts 映射已完成
  - 状态显示：`✓ 特殊格式(可处理)`
  - 或：`✓ 特殊格式(待配置)` - 项目尚未配置 parts，但文件格式正确
  
- **普通格式文件**：Source/Target 已选择
  - 状态显示：`✓ 可处理`
  - 或：`✓ 格式正常(待配置)` - 项目尚未配置任何部件，但文件格式正确

**用户需要做的**：无需操作，该文件可直接进行批处理。

---

### ⚠ 警告（Warning）

**含义**：文件配置不完整或存在问题。

**具体适用场景**：

#### 特殊格式文件的警告
- `⚠ 未映射: part1, part2` - 指定的 parts 尚未配置映射关系
  - **解决方案**：在项目配置中添加缺失 parts 的映射
  
- `⚠ Source缺失: part→source_name` - 指定的 Source 部件不在项目配置中
  - **解决方案**：在项目配置中添加该 Source 部件，或更新映射关系
  
- `⚠ Target缺失: part→target_name` - 指定的 Target 部件不在项目配置中
  - **解决方案**：在项目配置中添加该 Target 部件，或更新映射关系

#### 普通格式文件的警告
- `⚠ 未选择 Source/Target` - 缺少必要的 Source 或 Target 选择
  - **解决方案**：为该文件选择 Source 和 Target 部件
  
- `⚠ Source缺失: source_name` - 选择的 Source 不在项目配置中
  - **解决方案**：在项目配置中添加该 Source，或重新选择存在的 Source
  
- `⚠ Target缺失: target_name` - 选择的 Target 不在项目配置中
  - **解决方案**：在项目配置中添加该 Target，或重新选择存在的 Target

**用户需要做的**：根据具体警告信息修改项目配置或文件选择设置。

---

### ❓ 问号（Unverified/Unknown）

**含义**：文件状态无法验证。

**适用场景**：
- 验证过程出错或异常
- 数据加载失败
- 系统无法确定该文件是否可以处理

**用户需要做的**：检查应用日志文件以了解具体错误原因。

---

## 快速操作指南

### 当看到 ⚠ 警告符号时

1. **查看详细提示**：将鼠标悬停在文件树中的文件项上，查看具体警告信息
2. **根据警告类型操作**：
   - 如果涉及 parts 映射 → 编辑项目配置的 parts 映射
   - 如果涉及选择问题 → 选择存在的 Source/Target
3. **验证后重新加载**：修改配置后，重新扫描文件列表以刷新验证状态

### 当看到 ❓ 问号符号时

1. **打开应用日志**：通常位于 `log/` 目录或通过菜单访问
2. **搜索该文件相关的错误信息**：检查验证失败的具体原因
3. **根据错误提示进行调试**

---

## 技术实现

### 符号常量定义

在 `gui/managers.py` 中定义：

```python
STATUS_SYMBOL_READY = "✓"        # 文件已就绪
STATUS_SYMBOL_WARNING = "⚠"      # 文件配置不完整
STATUS_SYMBOL_UNVERIFIED = "❓"   # 文件状态无法验证
```

### 验证方法

文件验证由以下方法执行：

#### 特殊格式文件验证
- 位置：`gui/batch_manager.py` - `_validate_special_format()` 方法
- 检查项：parts 映射完整性、Source/Target 配置存在性

#### 普通格式文件验证
- 位置：`gui/batch_manager.py` - `_determine_part_selection_status()` 方法
- 检查项：Source/Target 选择状态、选择项是否在项目配置中存在

### 自助帮助功能

调用以下函数可显示符号说明对话框：

```python
from gui.managers import show_status_symbol_help

show_status_symbol_help(parent_widget)  # parent_widget 是 QWidget 实例
```

---

## 常见问题

**Q: 为什么我的文件显示 ⚠ 警告而不是 ✓ 就绪？**

A: 通常是因为：
- 项目尚未配置所有必要的 parts
- 已选择的 Source/Target 在项目中不存在
- 部分 parts 映射配置不完整

查看具体警告信息以了解具体原因。

**Q: 如何让 ❓ 问号变成 ✓？**

A: 首先检查日志以找出验证失败的原因，然后：
- 确保文件格式有效
- 确保项目配置正确加载
- 重新扫描文件列表以重新验证

**Q: 状态符号何时更新？**

A: 状态符号在以下情况下更新：
- 浏览和选择新文件时
- 修改项目配置后（需要重新扫描文件）
- 为文件重新选择 Source/Target 时

---

## 相关设置

### 项目配置文件格式

部件（parts）配置示例：

```json
{
  "source_parts": {
    "part1": { ... },
    "part2": { ... }
  },
  "target_parts": {
    "output1": { ... },
    "output2": { ... }
  }
}
```

### 特殊格式映射配置

```json
{
  "special_part_mapping_by_file": {
    "/path/to/file.mtfmt": {
      "inner_part1": {
        "source": "part1",
        "target": "output1"
      }
    }
  }
}
```

---

## 参考资源

- [项目文档](README.md)
- 应用菜单中的"关于"或"帮助"部分
- 日志文件位置和访问方式

